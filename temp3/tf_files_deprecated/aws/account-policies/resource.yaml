---
resource:
  aws_ebs_encryption_by_default:
    example:
      enabled: true
  aws_iam_policy:
    policy:
      for_each: ${fileset("${path.module}/custom_iam_policies", "*")}
      name: ${split(".", each.value)[0]}
      path: /
      policy: ${file("${path.module}/custom_iam_policies/${each.value}")}
  aws_iam_role:
    role:
      count: ${length(var.roles)}
      name: ${var.roles[count.index]}
      assume_role_policy: "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRoleWithSAML\",\n      \"Effect\": \"Allow\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"SAML:aud\": \"https://signin.aws.amazon.com/saml\"\n        }\n      },\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:saml-provider/UChicagoIdP\"\n      }\n    }\n  ]\n}"
  aws_iam_role_policy_attachment:
    policy_attachment:
      depends_on:
        ${aws_iam_role.role}
        ${aws_iam_policy.policy}
      count: ${length(local.relevant_iam_policies)}
      role: ${local.relevant_iam_policies[count.index].role}
      policy_arn: ${local.relevant_iam_policies[count.index].policy}
  aws_iam_saml_provider:
    uchicagoidp:
      name: UChicagoIdP
      saml_metadata_document: ${file("${path.module}/metadata/saml-metadata.xml")}
  aws_s3_account_public_access_block:
    example:
      block_public_acls: true
      block_public_policy: true
