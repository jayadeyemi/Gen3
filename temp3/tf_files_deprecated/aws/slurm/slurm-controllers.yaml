---
module:
  slurm-controllers:
    source: terraform-aws-modules/autoscaling/aws
    version: ~> 3.0
    name: ${var.slurm_asgs["controllers"]["asg_name"]}
    lc_name: ${var.slurm_asgs["controllers"]["asg_name"]}_launch_configuration
    image_id: ${data.aws_ami.public_ami.id}
    instance_type: ${var.slurm_asgs["controllers"]["instance_type"]}
    security_groups: ${var.slurm_asgs["controllers"]["security_groups"]}
    associate_public_ip_address: ${var.slurm_asgs["controllers"]["public_ip"]}
    recreate_asg_when_lc_changes: ${var.slurm_asgs["controllers"]["recreate_on_lc_changes"]}
    iam_instance_profile: ${aws_iam_instance_profile.slurm_nodes_instance_profile.id}
    user_data: ${local.user_common_data} ${local.user_controller_data}
    root_block_device:
      volume_size: ${var.slurm_asgs["controllers"]["root_block"]["volume_size"]}
      volume_type: ${var.slurm_asgs["controllers"]["root_block"]["volume_type"]}
      delete_on_termination: ${var.slurm_asgs["controllers"]["root_block"]["delete_on_termination"]}
      encryption: true
    asg_name: ${var.slurm_asgs["controllers"]["asg_name"]}
    vpc_zone_identifier: ${var.slurm_asgs["controllers"]["subnets_id"]}
    health_check_type: ${var.slurm_asgs["controllers"]["health_check_type"]}
    min_size: ${var.slurm_asgs["controllers"]["min_size"]}
    max_size: ${var.slurm_asgs["controllers"]["max_size"]}
    desired_capacity: ${var.slurm_asgs["controllers"]["desired_capasity"]}
    wait_for_capacity_timeout: 0
    tags_as_map: ${var.slurm_asgs["controllers"]["tags"]}
    tags:
      key: slurm-type
      value: controller
      propagate_at_launch: true
