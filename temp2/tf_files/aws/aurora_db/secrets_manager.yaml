---
module:
  - secrets_manager:
    count: '${var.secrets_manager_enabled ? 1 : 0}'
    source: ../modules/secrets_manager
    vpc_name: ${var.vpc_name}
    secret: '${templatefile("${path.module}/secrets_manager.tftpl", {"hostname": "${data.aws_db_instance.database.address}", "database": "${local.database_name}", "username": "${local.database_username}", "password": "${local.database_password}"})}'
    secret_name: ${var.namespace}-${var.service}-creds
    depends_on:
      - ${null_resource.user_setup}
