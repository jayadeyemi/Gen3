resource:
- aws_iam_role:
    image_builder:
      name: ${var.pipeline_name}-image-builder-role
      assume_role_policy: ${data.aws_iam_policy_document.assume_role.json}
- aws_iam_role_policy_attachment:
    amazon_ssm:
      role: ${aws_iam_role.image_builder.name}
      policy_arn: arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
- aws_iam_role_policy_attachment:
    image_builder:
      role: ${aws_iam_role.image_builder.name}
      policy_arn: arn:aws:iam::aws:policy/EC2InstanceProfileForImageBuilder
- aws_iam_role_policy_attachment:
    image_builder_ecr:
      role: ${aws_iam_role.image_builder.name}
      policy_arn: arn:aws:iam::aws:policy/EC2InstanceProfileForImageBuilderECRContainerBuilds
- aws_iam_instance_profile:
    image_builder:
      name: ${var.pipeline_name}-image-builder-profile
      role: ${aws_iam_role.image_builder.name}
data:
- aws_iam_policy_document:
    assume_role:
      statement:
      - actions:
        - sts:AssumeRole
        principals:
        - type: Service
          identifiers:
          - ec2.amazonaws.com
