resource:
- aws_cognito_user_pool:
    pool:
      name: ${var.vpc_name}_user_pool
      tags: ${var.tags}
- aws_cognito_user_pool_domain:
    main:
      domain: ${var.cognito_domain_name}
      user_pool_id: ${aws_cognito_user_pool.pool.id}
- aws_cognito_identity_provider:
    provider:
      attribute_mapping: ${var.cognito_attribute_mapping}
      provider_details: ${var.cognito_provider_details}
      provider_name: ${var.cognito_provider_name}
      provider_type: ${var.cognito_provider_type}
      user_pool_id: ${aws_cognito_user_pool.pool.id}
- aws_cognito_user_pool_client:
    client:
      allowed_oauth_flows: ${var.cognito_oauth_flows}
      allowed_oauth_flows_user_pool_client: true
      allowed_oauth_scopes: ${var.cognito_oauth_scopes}
      callback_urls: ${var.cognito_callback_urls}
      generate_secret: true
      name: ${var.cognito_user_pool_name}
      supported_identity_providers:
      - ${aws_cognito_identity_provider.provider.provider_name}
      user_pool_id: ${aws_cognito_user_pool.pool.id}
terraform:
- backend:
  - s3:
      encrypt: 'true'
  required_providers:
  - aws:
      source: hashicorp/aws
      version: ~> 5.0
---
output:
- cognito_user_pool_id:
    value: ${aws_cognito_user_pool.pool.id}
- cognito_domain:
    value: ${aws_cognito_user_pool_domain.main.domain}
- cognito_user_pool_client:
    value: ${aws_cognito_user_pool_client.client.id}
- cognito_user_pool_client_secret:
    sensitive: true
    value: ${aws_cognito_user_pool_client.client.client_secret}
---
variable:
- cognito_oauth_flows:
    default:
    - code
    - implicit
    description: Allowed OAuth Flows
- cognito_user_pool_name:
    default: fence
    description: App client
- cognito_provider_type:
    default: SAML
    description: Provider type
- cognito_attribute_mapping:
    default:
      email: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress
    description: Federation attribute mapping
- cognito_oauth_scopes:
    default:
    - email
    - openid
    description: Allowed OAuth Scopes
- cognito_provider_details:
    default: {}
    description: The identity provider details
- vpc_name:
    description: Commons name in which the cognito user pool will be created
- cognito_domain_name:
    description: Domain name for the user pool
- cognito_callback_urls:
    description: Callback URLs below that you will include in your sign in requests
- cognito_provider_name:
    description: Provider name
- tags:
    default:
      Environment: CSOC
      Organization: PlanX
    description: Tags for the resource
