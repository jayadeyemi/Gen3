locals:
- s3_origin_id: S3-Website-${var.access_url}.s3-website-us-east-1.amazonaws.com
resource:
- aws_s3_bucket:
    access:
      bucket: ${var.access_url}
- aws_s3_bucket_acl:
    access:
      acl: public-read
      bucket: ${aws_s3_bucket.access.id}
- aws_s3_bucket_cors_configuration:
    access:
      bucket: ${aws_s3_bucket.access.id}
      cors_rule:
      - allowed_headers:
        - '*'
        allowed_methods:
        - PUT
        - POST
        allowed_origins:
        - '*'
        expose_headers:
        - ETag
        max_age_seconds: 3000
- aws_s3_bucket_website_configuration:
    access:
      bucket: ${aws_s3_bucket.access.id}
      error_document:
      - key: index.html
      index_document:
      - suffix: index.html
- aws_cloudfront_distribution:
    access:
      aliases:
      - ${var.access_url}
      default_cache_behavior:
      - allowed_methods:
        - DELETE
        - GET
        - HEAD
        - OPTIONS
        - PATCH
        - POST
        - PUT
        cached_methods:
        - GET
        - HEAD
        default_ttl: 3600
        forwarded_values:
        - cookies:
          - forward: none
          query_string: false
        max_ttl: 86400
        min_ttl: 0
        target_origin_id: ${local.s3_origin_id}
        viewer_protocol_policy: allow-all
      default_root_object: index.html
      enabled: true
      is_ipv6_enabled: true
      origin:
      - custom_origin_config:
        - http_port: '80'
          https_port: '443'
          origin_protocol_policy: http-only
          origin_ssl_protocols:
          - TLSv1
          - TLSv1.1
          - TLSv1.2
        domain_name: ${aws_s3_bucket.access.website_endpoint}
        origin_id: ${local.s3_origin_id}
      price_class: PriceClass_200
      restrictions:
      - geo_restriction:
        - restriction_type: none
      tags:
        Environment: production
      viewer_certificate:
      - acm_certificate_arn: ${var.access_cert}
        cloudfront_default_certificate: true
        ssl_support_method: sni-only
terraform:
- backend:
  - s3:
      encrypt: 'true'
  required_providers:
  - aws:
      source: hashicorp/aws
      version: ~> 5.0
---
variable:
- access_url:
    default: ''
- access_cert:
    default: ''
