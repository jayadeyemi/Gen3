resource:
- aws_vpc_peering_connection_accepter:
    vpcpeering:
      auto_accept: true
      lifecycle:
      - ignore_changes: ${all}
      tags:
        Environment: ${var.vpc_name}
        Name: VPC Peering between ${var.vpc_name} and adminVM vpc
        Organization: ${var.organization_name}
      vpc_peering_connection_id: ${var.pcx_id}
- aws_route:
    r:
      depends_on:
      - ${aws_vpc_peering_connection_accepter.vpcpeering}
      destination_cidr_block: ${var.vpc_cidr_block}
      route_table_id: ${data.aws_route_table.selected.id}
      vpc_peering_connection_id: ${aws_vpc_peering_connection_accepter.vpcpeering.id}
---
data:
- aws_route_table:
    selected:
      filter:
      - name: tag:Name
        values:
        - ${var.route_table_name}
      vpc_id: ${var.csoc_vpc_id}
---
variable:
- vpc_name:
    default: ''
    description: Name of the VPC
    type: string
- route_table_name:
    default: eks_private
    description: Name of the route table to use for the peering connection
    type: string
- csoc_vpc_id:
    default: vpc-e2b51d99
    description: VPC ID of the peering connection
    type: string
- csoc_cidr:
    default: ''
    description: CIDR block of the peering connection
    type: string
- organization_name:
    default: cdis
    description: Name of the organization
    type: string
- vpc_cidr_block:
    default: ''
    description: CIDR block of the VPC
    type: string
- pcx_id:
    default: ''
    description: ID of the peering connection
    type: string
