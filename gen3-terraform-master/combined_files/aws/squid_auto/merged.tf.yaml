module:
- squid_auto:
    activation_id: ${var.activation_id}
    ami_account_id: ${var.ami_account_id}
    bootstrap_path: ${var.bootstrap_path}
    bootstrap_script: ${var.bootstrap_script}
    branch: ${var.branch}
    cluster_desired_capasity: ${var.cluster_desired_capasity}
    cluster_max_size: ${var.cluster_max_size}
    cluster_min_size: ${var.cluster_min_size}
    customer_id: ${var.customer_id}
    deploy_ha_squid: ${var.deploy_ha_squid}
    env_log_group: ${var.env_log_group}
    env_squid_name: ${var.env_squid_name}
    env_vpc_cidr: ${var.env_vpc_cidr}
    env_vpc_id: ${var.env_vpc_id}
    env_vpc_name: ${var.env_vpc_name}
    extra_vars: ${var.extra_vars}
    image_name_search_criteria: ${var.image_name_search_criteria}
    main_public_route: ${var.main_public_route}
    network_expansion: ${var.network_expansion}
    organization_name: ${var.organization_name}
    peering_cidr: ${var.peering_cidr}
    route_53_zone_id: ${var.route_53_zone_id}
    secondary_cidr_block: ${var.secondary_cidr_block}
    slack_webhook: ${var.slack_webhook}
    source: ../modules/squid_auto
    squid_availability_zones: ${var.squid_availability_zones}
    squid_instance_drive_size: ${var.squid_instance_drive_size}
    squid_instance_type: ${var.squid_instance_type}
    squid_proxy_subnet: ${var.squid_proxy_subnet}
    ssh_key_name: ${var.ssh_key_name}
terraform:
- backend:
  - s3:
      encrypt: 'true'
  required_providers:
  - aws:
      source: hashicorp/aws
      version: ~> 5.0
---
variable:
- env_vpc_cidr: {}
- squid_proxy_subnet: {}
- env_vpc_name: {}
- env_squid_name: {}
- ami_account_id:
    default: 099720109477
- image_name_search_criteria:
    default: ubuntu/images/hvm-ssd/ubuntu-*-20.04-amd64-server-*
- peering_cidr:
    default: 10.128.0.0/20
- secondary_cidr_block: {}
- bootstrap_path:
    default: cloud-automation/flavors/squid_auto/
- bootstrap_script:
    default: squid_running_on_docker.sh
- squid_instance_type:
    default: t3.medium
    description: instance type that replicas of squid will be deployed into
- organization_name:
    default: Basic Services
    description: basically for tagging porpuses
- env_log_group:
    description: log group in which to send logs from the instance
- env_vpc_id:
    description: the vpc id where the proxy cluster will reside
- ssh_key_name:
    description: ssh key name that instances in the cluster will use
- squid_instance_drive_size:
    default: 8
    description: Size of the root volume for the instance
- squid_availability_zones:
    description: AZs on wich to associate the routes for the squid proxies
- main_public_route:
    description: The route table that allows public access
- private_kube_route:
    description: public kube route table id
- route_53_zone_id:
    description: DNS zone for .internal.io
- branch:
    default: master
    description: branch to use in bootstrap script
- extra_vars:
    default:
    - squid_image=master
    description: additional variables to pass along with the bootstrapscript
- cluster_desired_capasity:
    default: 2
- cluster_max_size:
    default: 3
- cluster_min_size:
    default: 1
- network_expansion:
    default: true
- deploy_ha_squid:
    default: true
- activation_id:
    default: ''
- customer_id:
    default: ''
- slack_webhook:
    default: ''
